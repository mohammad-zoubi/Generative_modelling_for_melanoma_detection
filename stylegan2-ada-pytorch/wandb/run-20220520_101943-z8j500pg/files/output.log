Downloading: "https://github.com/lukemelas/EfficientNet-PyTorch/releases/download/1.0/efficientnet-b2-8bb594d6.pth" to /home/moh/.cache/torch/hub/checkpoints/efficientnet-b2-8bb594d6.pth
 47%|███████████████████████████████████████████████████████████████████████████████████████████▌                                                                                                      | 16.6M/35.1M [00:00<00:00, 20.3MB/s]
50000
25000
label_0_idx_val [  0   1   2   3   4   5   6   7   8   9  10  11  12  13  15  16  17  19
  20  21  22  23  24  26  27  28  29  31  32  33  34  35  36  37  39  40
  41  42  43  45  47  48  50  51  52  53  54  56  57  58  59  60  62  63
  64  65  66  67  68  69  70  71  72  73  74  75  76  77  78  79  81  82
  83  84  85  86  87  89  90  91  92  93  94  95  96  97  98  99 100 101
 103 104 106 107 108 109 110 111 112 113 114 116 117 118 119 120 121 122
 123 124 125 126 127 128 129 130 131 132 133 134 135 136 138 139 140 141
 142 143 144 145 146 147 148 149 150 152 155 156 157 158 160 161 163 164
 165 166 167 168 170 171 172 174 176 177 178 180 181 182 183 184 185 186
 189 191 193 194 195 196 197 198 199 200 201 203 204 205 206 207 208 209
 210 211 212 213 214 215 216 217 218 219 222 224 225 226 227 228 229 230
 231 232 233 234 235 236 237 238 240 242 244 245 246 247 248 249 250 251
 253 254 256 257 258 259 260 261 262 264 265 266 267 269 270 271 274 275
 276 277 278 279 280 281 282 283 284 285 287 288 289 290 291 292 294 295
 296 297 298 299 300 302 303 304 305 306 307 308 309 310 311 312 313 314
 315 316 319 321 322 323 325 326 327 328 329 330 331 333 334 335 336 338
 339 340 341 342 343 344 345 346 347 348 349 350 352 353 354 355 356 357
 358 359 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375
 376 377 378 380 381 382 384 386 387 388 389 390 391 393 394 396 397 398
 399 400 401 402 403 404 405 406 407 408 409 410 412 413 414 415 416 417
 418 419 421 422 424 425 426 427 428 429 430 431 432 433 434 436 437 438
 439 440 441 442 444 445 446 447 448 449 451 452 454 455 456 457 458 459
 461 463 464 465 466 467 468 469 470 471 472 473 474 475 476 477 478 479
 483 484 485 486 488 489 490 491 492 493 494 495 496 497 498 499 500 501
 502 503 505 506 507 509 510 511 512 513 514 516 517 518 519 520 521 522
 523 524 525 526 527 528 529 530 531 532 533 534 535 536 537 538 540 543
 544 545 547 548 549 551 552 553 554 555 556 557 558 560 561 562 564 565
 567 568 569 570 571 572 573 574 575 577 578 579 580 581 582 583 584 585
 586 587 588 590 591 592 593 594 595 596 597 599 600 602 604 605 606 607
 608 609 610 611 613 614 615 616 617 618 619 620 621 622 623 624 625 626
 627 628 629 630 631 633 634 635 636 637 638 639 642 643 644 645 646 647
 648 649 650 651 652 653 654 655 656 657 658 659 660 661 662 663 664 665
 666 667 668 669 670 671 672 673 674 675 676 677 678 679 680 681 682 683
 684 686 687 689 690 691 692 693 694 695 696 697 698 699 701 702 703 704
 705 706 707 708 709 710 711 712 714 715 716 717 718 719 721 722 723 724
 725 727 728 730 731 732 734 735 736 737 738 741 742 743 744 746 747 748
 749 750 751 753 754 755 756 757 758 759 760 761 762 763 764 765 766 767
 768 769 770 771 772 773 775 777 778 779 780 781 782 783 784 785 786 787
 788 789 790 791 794 795 796 797 798 799 800 801 802 803 804 805 806 807
 810 811 812 813 814 815 816 817 818 819 820 821 822 823 824 825 826 827
 828 829 830 831 832 833 834 835 836 837 838 839 840 842 843 844 845 846
 847 848 849 850 851 853 854 855 856 857 858 859 860 861 862 863 864 865
 866 867 868 869 870 871 873 874 875 876] label_1_idx_val [  14   18   25   30   38   44   46   49   55   61   80   88  102  105
  115  137  151  153  154  159  162  169  173  175  179  187  188  190
  192  202  220  221  223  239  241  243  252  255  263  268  272  273
  286  293  301  317  318  320  324  332  337  351  379  383  385  392
  395  411  420  423  435  443  450  453  460  462  480  481  482  487
  504  508  515  539  541  542  546  550  559  563  566  576  589  598
  601  603  612  632  640  641  685  688  700  713  720  726  729  733
  739  740  745  752  774  776  792  793  808  809  841  852  872  879
  881  888  900  901  910  917  924  934  938  941  952  961  972  973
  985  986  992  996  997 1005 1011 1014 1017 1028 1034 1065 1068 1071
 1073 1098 1100 1105 1115 1128 1163 1164 1166 1178 1182 1189 1195 1200
 1215 1216 1227 1232 1233 1236 1242 1246 1254 1260 1268 1274 1276 1286
 1302 1303 1306 1316 1317 1323 1334 1341 1347 1348 1352 1357 1361 1362
 1364 1365 1376 1378 1390 1405 1411 1416 1422 1425 1437 1444 1445 1446
 1452 1453 1456 1458 1467 1469 1470 1472 1476 1481 1497 1499 1502 1503
 1504 1513 1524 1527 1529 1533 1541 1564 1580 1587 1593 1596 1600 1603
 1619 1626 1633 1636 1644 1656 1659 1661 1676 1685 1693 1701 1703 1708
 1712 1714 1718 1725 1727 1731 1738 1756 1766 1768 1784 1826 1827 1829
 1831 1839 1840 1859 1864 1865 1868 1870 1872 1895 1904 1932 1948 1949
 1954 1965 1980 1986 1989 1999 2019 2024 2031 2033 2039 2052 2055 2056
 2063 2068 2073 2075 2109 2117 2121 2123 2125 2140 2143 2165 2180 2191
 2192 2196 2198 2212 2216 2219 2220 2221 2227 2230 2240 2244 2246 2253
 2256 2276 2295 2297 2314 2323 2351 2357 2369 2371 2375 2378 2382 2389
 2415 2423 2432 2452 2455 2456 2482 2493 2500 2510 2523 2525 2535 2545
 2548 2552 2557 2558 2560 2564 2566 2573 2589 2601 2624 2643 2644 2645
 2652 2656 2676 2679 2696 2698 2705 2711 2712 2734 2754 2757 2761 2766
 2768 2771 2774 2784 2798 2806 2810 2813 2817 2820 2834 2837 2838 2847
 2849 2853 2858 2869 2874 2884 2888 2896 2905 2910 2920 2923 2929 2930
 2954 2964 2968 2989 2990 2991 2998 2999 3006 3010 3012 3028 3029 3031
 3032 3033 3038 3047 3050 3062 3070 3081 3104 3114 3116 3117 3119 3122
 3146 3152 3155 3160 3162 3170 3185 3187 3189 3193 3198 3200 3203 3209
 3219 3223 3229 3233 3253 3257 3260 3266 3271 3289 3299 3318 3319 3321
 3328 3329 3340 3341 3342 3347 3348 3351 3361 3366 3367 3387 3420 3421
 3427 3429 3436 3442 3445 3453 3458 3459 3466 3470 3472 3477 3487 3508
 3517 3545 3574 3579 3612 3614 3626 3627 3628 3631 3636 3651 3654 3665
 3666 3672 3681 3687 3702 3723 3724 3729 3736 3737 3745 3761 3764 3770
 3772 3775 3806 3815 3834 3842 3849 3850 3855 3870 3885 3887 3899 3906
 3910 3924 3942 3947 3953 3964 3970 3981 3982 3983 4017 4028 4032 4037
 4043 4058 4059 4083 4088 4091 4093 4106 4111 4125 4133 4135 4136 4139
 4140 4144 4168 4174 4184 4185 4197 4200 4202 4205 4209 4212 4217 4218
 4222 4232 4234 4239 4251 4262 4264 4272 4275 4280 4298 4302 4306 4311
 4317 4320 4322 4324 4339 4341 4348 4359 4366 4374 4393 4397 4398 4401
 4411 4420 4422 4425 4433 4434 4438 4440 4450 4451 4458 4463 4477 4487
 4502 4515 4517 4518 4523 4530 4546 4560 4562 4575 4594 4603 4620 4624
 4634 4638 4639 4644 4650 4655 4664 4671 4690 4691 4692 4693 4700 4717
 4724 4730 4734 4740 4742 4748 4763 4768 4786 4790 4803 4804 4811 4817
 4819 4831 4833 4839 4840 4847 4858 4861 4863 4867 4884 4886 4888 4901
 4907 4912 4918 4919 4920 4924 4939 4940 4950 4952 4953 4957 4971 4980
 4984 4985 4992 5017 5029 5030 5035 5040 5044 5045 5053 5059 5071 5074
 5081 5085 5086 5097 5104 5116 5124 5129 5130 5136 5144 5145 5150 5151
 5161 5165 5175 5179 5184 5192 5196 5211 5221 5224 5231 5253 5257 5273
 5275 5280 5288 5290 5294 5297 5300 5310 5322 5323 5333 5336 5339 5343
 5362 5363 5368 5375 5380 5389 5392 5402 5418 5420 5422 5430 5432 5433
 5438 5440 5441 5452 5456 5479 5489 5493 5508 5510 5523 5529 5534 5536
 5545 5546 5556 5565 5586 5587 5596 5602 5606 5617]
50000 1532

100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 35.1M/35.1M [00:01<00:00, 19.8MB/s]
Loaded pretrained weights for efficientnet-b2
Model efficientnet-b2 loaded.
8,405,995 total parameters.
8,405,995 training parameters.
Starts training...
Epoch: 1/15..  Training Loss: 0.065..  Training Accuracy: 0.975.. Validation Loss: 0.728..  Validation Accuracy: 0.854 Validation AUC Score: 0.953 Validation F1 Score: 0.832 Training Time: 0:04:25
Saving model in training_classifiers_events/test_all_melanoma/5_20/./classifier_efficientnet-b2_0.8544_2022-05-20 10:25:00.398757.pth
Epoch: 2/15..  Training Loss: 0.016..  Training Accuracy: 0.995.. Validation Loss: 0.683..  Validation Accuracy: 0.847 Validation AUC Score: 0.953 Validation F1 Score: 0.824 Training Time: 0:04:23
Epoch: 3/15..  Training Loss: 0.011..  Training Accuracy: 0.996.. Validation Loss: 0.841..  Validation Accuracy: 0.832 Validation AUC Score: 0.945 Validation F1 Score: 0.803 Training Time: 0:04:18
Epoch     3: reducing learning rate of group 0 to 1.0000e-04.
Epoch: 4/15..  Training Loss: 0.002..  Training Accuracy: 0.999.. Validation Loss: 0.845..  Validation Accuracy: 0.838 Validation AUC Score: 0.934 Validation F1 Score: 0.814 Training Time: 0:04:02
Epoch: 5/15..  Training Loss: 0.001..  Training Accuracy: 1.000.. Validation Loss: 0.867..  Validation Accuracy: 0.850 Validation AUC Score: 0.941 Validation F1 Score: 0.830 Training Time: 0:03:51
Epoch     5: reducing learning rate of group 0 to 2.0000e-05.
Epoch: 6/15..  Training Loss: 0.000..  Training Accuracy: 1.000.. Validation Loss: 0.956..  Validation Accuracy: 0.844 Validation AUC Score: 0.940 Validation F1 Score: 0.823 Training Time: 0:03:48
Epoch: 7/15..  Training Loss: 0.000..  Training Accuracy: 1.000.. Validation Loss: 0.879..  Validation Accuracy: 0.854 Validation AUC Score: 0.943 Validation F1 Score: 0.837 Training Time: 0:03:48
Epoch     7: reducing learning rate of group 0 to 4.0000e-06.
Early stopping. Best Val f1: 0.854
Total Training Time: 0:28:38
Test Accuracy: 0.95433, ROC_AUC_score: 0.95705, F1 score: 0.8106
Traceback (most recent call last):
  File "melanoma_classifier.py", line 375, in <module>
    confussion_matrix(test_gt, test_pred, test_accuracy, writer_path, classification_task_name)
  File "/ISIC256/project_scripts/GITHUB_REPO/Generative_modelling_for_melanoma_detection/stylegan2-ada-pytorch/utils.py", line 252, in confussion_matrix
    plt.savefig(os.path.join(writer_path, f'conf_matrix_{test_accuracy:.4f}_{now.strftime("%d_%m_%H_%M")}.png')+ classification_task_name)
  File "/usr/local/lib/python3.8/dist-packages/matplotlib/pyplot.py", line 979, in savefig
    res = fig.savefig(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/matplotlib/figure.py", line 3046, in savefig
    self.canvas.print_figure(fname, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/matplotlib/backend_bases.py", line 2259, in print_figure
    canvas = self._get_output_canvas(backend, format)
  File "/usr/local/lib/python3.8/dist-packages/matplotlib/backend_bases.py", line 2188, in _get_output_canvas
    raise ValueError(
ValueError: Format 'pngbaseline' is not supported (supported formats: eps, jpeg, jpg, pdf, pgf, png, ps, raw, rgba, svg, svgz, tif, tiff)